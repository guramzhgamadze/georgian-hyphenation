/**
 * Comprehensive Test Suite for GeorgianHyphenator v2.2.1
 * Includes Local Dictionary (exceptions.json) Validation
 */
import GeorgianHyphenator from './src/javascript/index.js';
import { readFileSync } from 'fs';
import { join } from 'path';

async function runTests() {
    console.log('­Ъџђ рЃЦрЃљрЃарЃЌрЃБрЃџрЃў рЃЊрЃљрЃЏрЃљрЃарЃфрЃЋрЃџрЃўрЃА рЃЉрЃўрЃЉрЃџрЃўрЃЮрЃЌрЃћрЃЎрЃўрЃА рЃбрЃћрЃАрЃбрЃўрЃарЃћрЃЉрЃљ рЃўрЃгрЃДрЃћрЃЉрЃљ...\n');

    const hyphenator = new GeorgianHyphenator('-');

    // рЃбрЃћрЃАрЃбрЃў 1: рЃЉрЃљрЃќрЃўрЃАрЃБрЃарЃў рЃЊрЃљрЃЏрЃљрЃарЃфрЃЋрЃџрЃљ
    console.log('--- рЃбрЃћрЃАрЃбрЃў 1: рЃЉрЃљрЃќрЃўрЃАрЃБрЃарЃў рЃљрЃџрЃњрЃЮрЃарЃўрЃЌрЃЏрЃў ---');
    const basicWord = 'рЃАрЃљрЃЦрЃљрЃарЃЌрЃЋрЃћрЃџрЃЮ';
    const basicResult = hyphenator.hyphenate(basicWord);
    console.log(`рЃАрЃўрЃбрЃДрЃЋрЃљ: ${basicWord} -> ${basicResult}`);
    if (basicResult === 'рЃАрЃљ-рЃЦрЃљрЃа-рЃЌрЃЋрЃћ-рЃџрЃЮ') {
        console.log('РюЁ рЃгрЃљрЃарЃЏрЃљрЃбрЃћрЃЉрЃўрЃЌ рЃЊрЃљрЃЏрЃљрЃарЃфрЃЋрЃџрЃўрЃџрЃўрЃљ\n');
    }

    // рЃбрЃћрЃАрЃбрЃў 2: рЃ░рЃљрЃарЃЏрЃЮрЃюрЃўрЃБрЃџрЃў рЃ»рЃњрЃБрЃцрЃћрЃЉрЃў (Harmonic Clusters)
    console.log('--- рЃбрЃћрЃАрЃбрЃў 2: рЃ░рЃљрЃарЃЏрЃЮрЃюрЃўрЃБрЃџрЃў рЃ»рЃњрЃБрЃцрЃћрЃЉрЃў ---');
    const clusterWord = 'рЃЏрЃгрЃЋрЃарЃЌрЃюрЃћрЃџрЃў'; 
    console.log(`рЃАрЃўрЃбрЃДрЃЋрЃљ: ${clusterWord} -> ${hyphenator.hyphenate(clusterWord)}`);
    console.log('РюЁ рЃ░рЃљрЃарЃЏрЃЮрЃюрЃўрЃБрЃџрЃў рЃ»рЃњрЃБрЃцрЃћрЃЉрЃўрЃА рЃџрЃЮрЃњрЃўрЃЎрЃљ рЃерЃћрЃЏрЃЮрЃгрЃЏрЃћрЃЉрЃБрЃџрЃўрЃљ\n');

    // рЃбрЃћрЃАрЃбрЃў 3: рЃЊрЃљрЃЏрЃљрЃарЃфрЃЋрЃџрЃўрЃА рЃАрЃўрЃЏрЃЉрЃЮрЃџрЃЮрЃћрЃЉрЃўрЃАрЃњрЃљрЃю рЃњрЃљрЃАрЃБрЃцрЃЌрЃљрЃЋрЃћрЃЉрЃљ (Sanitization)
    console.log('--- рЃбрЃћрЃАрЃбрЃў 3: рЃњрЃљрЃАрЃБрЃцрЃЌрЃљрЃЋрЃћрЃЉрЃўрЃА рЃцрЃБрЃюрЃЦрЃфрЃўрЃљ (_stripHyphens) ---');
    const preHyphenated = 'рЃАрЃљ\u00ADрЃЦрЃљрЃа\u00ADрЃЌрЃЋрЃћ\u00ADрЃџрЃЮ'; 
    const cleaned = hyphenator.hyphenateText(preHyphenated);
    console.log(`рЃЮрЃарЃўрЃњрЃўрЃюрЃљрЃџрЃў (рЃАрЃЮрЃцрЃЌ-рЃ░рЃљрЃўрЃцрЃћрЃюрЃћрЃЉрЃўрЃЌ): ${preHyphenated.replace(/\u00AD/g, '[SH]')}`);
    console.log(`рЃерЃћрЃЊрЃћрЃњрЃў: ${cleaned}`);
    if (cleaned.includes('-')) {
        console.log('РюЁ рЃФрЃЋрЃћрЃџрЃў рЃ░рЃљрЃўрЃцрЃћрЃюрЃћрЃЉрЃў рЃгрЃљрЃўрЃерЃљрЃџрЃљ рЃЊрЃљ рЃљрЃ«рЃљрЃџрЃў рЃЊрЃљрЃћрЃЏрЃљрЃбрЃљ\n');
    }

    // рЃбрЃћрЃАрЃбрЃў 4: рЃЏрЃљрЃарЃфрЃЋрЃџрЃћрЃЉрЃўрЃА рЃЏрЃљрЃАрЃўрЃЋрЃўрЃА рЃЏрЃўрЃдрЃћрЃЉрЃљ
    console.log('--- рЃбрЃћрЃАрЃбрЃў 4: рЃЏрЃљрЃарЃфрЃЋрЃџрЃћрЃЉрЃўрЃА рЃЏрЃљрЃАрЃўрЃЋрЃў (getSyllables) ---');
    const syllables = hyphenator.getSyllables('рЃБрЃюрЃўрЃЋрЃћрЃарЃАрЃўрЃбрЃћрЃбрЃў');
    console.log(`рЃЏрЃљрЃарЃфрЃЋрЃџрЃћрЃЉрЃў: [${syllables.join(', ')}]`);
    console.log('РюЁ рЃЏрЃљрЃАрЃўрЃЋрЃўрЃА рЃцрЃЮрЃарЃЏрЃљрЃбрЃў рЃАрЃгрЃЮрЃарЃўрЃљ\n');

    // рЃбрЃћрЃАрЃбрЃў 5: рЃЏрЃЌрЃџрЃўрЃљрЃюрЃў рЃбрЃћрЃЦрЃАрЃбрЃўрЃА рЃЊрЃљрЃЏрЃБрЃерЃљрЃЋрЃћрЃЉрЃљ
    console.log('--- рЃбрЃћрЃАрЃбрЃў 5: рЃбрЃћрЃЦрЃАрЃбрЃўрЃА рЃЊрЃљрЃЏрЃБрЃерЃљрЃЋрЃћрЃЉрЃљ (hyphenateText) ---');
    const text = 'рЃњрЃљрЃЏрЃљрЃарЃ»рЃЮрЃЉрЃљ, рЃАрЃљрЃЦрЃљрЃарЃЌрЃЋрЃћрЃџрЃЮ рЃЏрЃерЃЋрЃћрЃюрЃўрЃћрЃарЃў рЃЦрЃЋрЃћрЃДрЃљрЃюрЃљрЃљ!';
    const hyphenatedText = hyphenator.hyphenateText(text);
    console.log(`рЃбрЃћрЃЦрЃАрЃбрЃў: ${hyphenatedText}`);
    console.log('РюЁ рЃърЃБрЃюрЃЦрЃбрЃБрЃљрЃфрЃўрЃљ рЃерЃћрЃюрЃљрЃарЃЕрЃБрЃюрЃћрЃЉрЃБрЃџрЃўрЃљ\n');

    // рЃбрЃћрЃАрЃбрЃў 6: рЃЊрЃўрЃАрЃбрЃљрЃюрЃфрЃўрЃБрЃарЃў рЃџрЃћрЃЦрЃАрЃўрЃЎрЃЮрЃюрЃўрЃА рЃЕрЃљрЃбрЃЋрЃўрЃарЃЌрЃЋрЃљ
    console.log('--- рЃбрЃћрЃАрЃбрЃў 6: рЃЊрЃўрЃАрЃбрЃљрЃюрЃфрЃўрЃБрЃарЃў рЃџрЃћрЃЦрЃАрЃўрЃЎрЃЮрЃюрЃў (Fetch) ---');
    try {
        await hyphenator.loadDefaultLibrary();
        if (hyphenator.dictionary.size > 0) {
            console.log(`РюЁ рЃЊрЃўрЃАрЃбрЃљрЃюрЃфрЃўрЃБрЃарЃў рЃџрЃћрЃЦрЃАрЃўрЃЎрЃЮрЃюрЃў рЃЕрЃљрЃўрЃбрЃЋрЃўрЃарЃЌрЃљ. рЃќрЃЮрЃЏрЃљ: ${hyphenator.dictionary.size}\n`);
        }
    } catch (e) {
        console.log('Рё╣№ИЈ рЃЊрЃўрЃАрЃбрЃљрЃюрЃфрЃўрЃБрЃарЃў Fetch рЃњрЃљрЃЏрЃЮрЃўрЃбрЃЮрЃЋрЃћрЃЉрЃљ (Node рЃњрЃљрЃарЃћрЃЏрЃЮ)\n');
    }

    // рЃбрЃћрЃАрЃбрЃў 7: рЃџрЃЮрЃЎрЃљрЃџрЃБрЃарЃў exceptions.json-рЃўрЃА рЃерЃћрЃЏрЃЮрЃгрЃЏрЃћрЃЉрЃљ
    console.log('--- рЃбрЃћрЃАрЃбрЃў 7: рЃџрЃЮрЃЎрЃљрЃџрЃБрЃарЃў exceptions.json-рЃўрЃА рЃљрЃюрЃљрЃџрЃўрЃќрЃў ---');
    try {
        // рЃЋрЃћрЃФрЃћрЃЉрЃЌ рЃцрЃљрЃўрЃџрЃА рЃърЃарЃЮрЃћрЃЦрЃбрЃўрЃА рЃАрЃбрЃарЃБрЃЦрЃбрЃБрЃарЃљрЃерЃў
        const dataPath = join(process.cwd(), 'data', 'exceptions.json');
        const rawData = readFileSync(dataPath, 'utf8');
        const exceptions = JSON.parse(rawData);
        
        console.log(`рЃЏрЃЮрЃФрЃћрЃЉрЃюрЃўрЃџрЃўрЃљ рЃцрЃљрЃўрЃџрЃў: ${dataPath}`);
        hyphenator.loadLibrary(exceptions);
        
        if (hyphenator.dictionary.size > 0) {
            console.log(`РюЁ рЃџрЃћрЃЦрЃАрЃўрЃЎрЃЮрЃюрЃў рЃгрЃљрЃарЃЏрЃљрЃбрЃћрЃЉрЃўрЃЌ рЃерЃћрЃўрЃЋрЃАрЃЮ (${hyphenator.dictionary.size} рЃАрЃўрЃбрЃДрЃЋрЃљ)`);
            
            // рЃЋрЃбрЃћрЃАрЃбрЃљрЃЋрЃЌ рЃћрЃарЃЌ рЃЎрЃЮрЃюрЃЎрЃарЃћрЃбрЃБрЃџ рЃАрЃўрЃбрЃДрЃЋрЃљрЃА рЃџрЃћрЃЦрЃАрЃўрЃЎрЃЮрЃюрЃўрЃЊрЃљрЃю (рЃЏрЃљрЃњрЃљрЃџрЃўрЃЌрЃљрЃЊ "рЃЮрЃЉрЃўрЃћрЃЦрЃбрЃў")
            const testKey = Object.keys(exceptions)[0];
            if (testKey) {
                const dictResult = hyphenator.hyphenate(testKey);
                console.log(`рЃАрЃљрЃЎрЃЮрЃюрЃбрЃарЃЮрЃџрЃЮ рЃбрЃћрЃАрЃбрЃў рЃџрЃћрЃЦрЃАрЃўрЃЎрЃЮрЃюрЃўрЃЊрЃљрЃю: "${testKey}" -> "${dictResult}"`);
                console.log('РюЁ рЃџрЃћрЃЦрЃАрЃўрЃЎрЃЮрЃюрЃўрЃА рЃърЃарЃўрЃЮрЃарЃўрЃбрЃћрЃбрЃў рЃљрЃџрЃњрЃЮрЃарЃўрЃЌрЃЏрЃќрЃћ рЃЏрЃБрЃерЃљрЃЮрЃЉрЃА\n');
            }
        }
    } catch (error) {
        console.error(`РЮї exceptions.json рЃЋрЃћрЃа рЃЏрЃЮрЃўрЃФрЃћрЃЉрЃюрЃљ рЃљрЃю рЃЊрЃљрЃќрЃўрЃљрЃюрЃћрЃЉрЃБрЃџрЃўрЃљ: ${error.message}\n`);
    }

    console.log('Рюе рЃДрЃЋрЃћрЃџрЃљ рЃбрЃћрЃАрЃбрЃў рЃЊрЃљрЃАрЃарЃБрЃџрЃЊрЃљ!');
}

runTests().catch(err => {
    console.error('РЮї рЃбрЃћрЃАрЃбрЃўрЃарЃћрЃЉрЃўрЃАрЃљрЃА рЃЊрЃљрЃцрЃўрЃЦрЃАрЃўрЃарЃЊрЃљ рЃерЃћрЃфрЃЊрЃЮрЃЏрЃљ:', err);
    process.exit(1);
});